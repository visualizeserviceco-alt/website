<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard â€” Visualize Studio</title>
  <link rel="icon" type="image/svg+xml" href="../assets/images/Visualize.svg">
  <link rel="stylesheet" href="../assets/css/main.css">
  <link rel="stylesheet" href="../assets/css/components.css">
  <link rel="stylesheet" href="../assets/css/header.css">
  <link rel="stylesheet" href="../assets/css/footer.css">
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    .admin-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 40px var(--container-padding);
    }
    
    .admin-header {
      margin-bottom: 40px;
    }
    
    .admin-header h1 {
      font-size: clamp(32px, 5vw, 48px);
      margin: 0 0 16px;
      color: #fff;
    }
    
    .admin-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 24px;
      margin-bottom: 40px;
    }
    
    .stat-card {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 16px;
      padding: 24px;
    }
    
    .stat-card h3 {
      font-size: 14px;
      color: #ccc;
      margin: 0 0 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .stat-card .stat-value {
      font-size: 32px;
      font-weight: 900;
      color: var(--brand-red);
      margin: 0;
    }
    
    .admin-tabs {
      display: flex;
      gap: 16px;
      margin-bottom: 32px;
      border-bottom: 2px solid #333;
    }
    
    .admin-tab {
      padding: 16px 24px;
      background: transparent;
      border: none;
      color: #ccc;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
    }
    
    .admin-tab.active {
      color: #fff;
      border-bottom-color: var(--brand-red);
    }
    
    .admin-tab:hover {
      color: #fff;
    }
    
    .submissions-list {
      display: none;
    }
    
    .submissions-list.active {
      display: block;
    }
    
    .submission-card {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 16px;
      transition: all 0.3s ease;
    }
    
    .submission-card:hover {
      border-color: var(--brand-red);
      transform: translateY(-2px);
    }
    
    .submission-card.unread {
      border-color: var(--brand-red);
      background: rgba(212, 76, 67, 0.05);
    }
    
    .submission-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
    }
    
    .submission-info h3 {
      font-size: 20px;
      margin: 0 0 8px;
      color: #fff;
    }
    
    .submission-meta {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      font-size: 14px;
      color: #ccc;
    }
    
    .submission-meta span {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .submission-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
    }
    
    .badge-unread {
      background: var(--brand-red);
      color: #fff;
    }
    
    .badge-read {
      background: #333;
      color: #ccc;
    }
    
    .submission-content {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid #333;
    }
    
    .submission-content p {
      color: #ccc;
      line-height: 1.7;
      margin: 0;
    }
    
    .submission-actions {
      margin-top: 16px;
      display: flex;
      gap: 12px;
    }
    
    .btn-mark-read {
      padding: 8px 16px;
      background: #333;
      color: #fff;
      border: 1px solid #444;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
    }
    
    .btn-mark-read:hover {
      background: var(--brand-red);
      border-color: var(--brand-red);
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: #ccc;
    }
    
    .error {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid #ef4444;
      border-radius: 12px;
      padding: 16px;
      color: #ef4444;
      margin-bottom: 24px;
    }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #ccc;
    }
    
    .empty-state i {
      width: 64px;
      height: 64px;
      color: #666;
      margin-bottom: 16px;
    }
    
    @media (max-width: 768px) {
      .admin-stats {
        grid-template-columns: 1fr;
      }
      
      .submission-header {
        flex-direction: column;
        gap: 12px;
      }
    }
  </style>
</head>
<body>

<!-- HEADER INCLUDE -->
<div id="site-header" role="banner"></div>
<script>
  const basePath = window.location.pathname.includes('/pages/') ? '../' : '';
  fetch(basePath + 'includes/header.html')
    .then(response => response.text())
    .then(data => { 
      const updatedData = data.replace(/src="assets\//g, `src="${basePath}assets/`);
      document.getElementById('site-header').innerHTML = updatedData;
      
      if (window.visualizeWebsite && typeof window.visualizeWebsite.setupMobileMenu === 'function') {
        window.visualizeWebsite.setupMobileMenu();
      }
      
      document.dispatchEvent(new CustomEvent('headerLoaded'));
    });
</script>

<main role="main" style="background: #000; min-height: 100vh; padding: 40px 0;">
  <div class="admin-container">
    <div class="admin-header">
      <h1>Form Submissions</h1>
      <p style="color: #ccc; margin: 0;">View and manage contact form and quote request submissions</p>
    </div>
    
    <!-- Stats -->
    <div class="admin-stats" id="stats-container">
      <div class="stat-card">
        <h3>Contact Submissions</h3>
        <p class="stat-value" id="contact-total">-</p>
      </div>
      <div class="stat-card">
        <h3>Unread Contact</h3>
        <p class="stat-value" id="contact-unread">-</p>
      </div>
      <div class="stat-card">
        <h3>Quote Requests</h3>
        <p class="stat-value" id="quote-total">-</p>
      </div>
      <div class="stat-card">
        <h3>Unread Quotes</h3>
        <p class="stat-value" id="quote-unread">-</p>
      </div>
    </div>
    
    <!-- Tabs -->
    <div class="admin-tabs">
      <button class="admin-tab active" data-tab="contact">Contact Forms</button>
      <button class="admin-tab" data-tab="quote">Quote Requests</button>
    </div>
    
    <!-- Contact Submissions -->
    <div class="submissions-list active" id="contact-submissions">
      <div class="loading">Loading contact submissions...</div>
    </div>
    
    <!-- Quote Submissions -->
    <div class="submissions-list" id="quote-submissions">
      <div class="loading">Loading quote submissions...</div>
    </div>
  </div>
</main>

<!-- FOOTER INCLUDE -->
<div id="site-footer" role="contentinfo"></div>
<script>
  const basePathFooter = window.location.pathname.includes('/pages/') ? '../' : '';
  fetch(basePathFooter + 'includes/footer.html')
    .then(response => response.text())
    .then(data => { 
      const updatedData = data.replace(/src="assets\//g, `src="${basePathFooter}assets/`);
      document.getElementById('site-footer').innerHTML = updatedData; 
    });
</script>

<script src="../assets/js/main.js"></script>
<script>
  lucide.createIcons();
  
  // Tab switching
  document.querySelectorAll('.admin-tab').forEach(tab => {
    tab.addEventListener('click', function() {
      const tabName = this.getAttribute('data-tab');
      
      // Update active tab
      document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
      this.classList.add('active');
      
      // Update active list
      document.querySelectorAll('.submissions-list').forEach(list => list.classList.remove('active'));
      document.getElementById(`${tabName}-submissions`).classList.add('active');
      
      // Load data if not already loaded
      if (tabName === 'contact') {
        loadContactSubmissions();
      } else {
        loadQuoteSubmissions();
      }
    });
  });
  
  // Load stats
  async function loadStats() {
    try {
      const response = await fetch('/api/submissions/stats');
      const data = await response.json();
      
      if (data.success) {
        document.getElementById('contact-total').textContent = data.stats.contact_total;
        document.getElementById('contact-unread').textContent = data.stats.contact_unread;
        document.getElementById('quote-total').textContent = data.stats.quote_total;
        document.getElementById('quote-unread').textContent = data.stats.quote_unread;
      }
    } catch (error) {
      console.error('Error loading stats:', error);
    }
  }
  
  // Load contact submissions
  async function loadContactSubmissions() {
    const container = document.getElementById('contact-submissions');
    container.innerHTML = '<div class="loading">Loading contact submissions...</div>';
    
    try {
      const response = await fetch('/api/submissions/contact');
      const data = await response.json();
      
      if (data.success) {
        if (data.submissions.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <i data-lucide="inbox"></i>
              <p>No contact submissions yet.</p>
            </div>
          `;
          lucide.createIcons();
          return;
        }
        
        container.innerHTML = data.submissions.map(sub => `
          <div class="submission-card ${sub.read ? '' : 'unread'}" data-id="${sub.id}">
            <div class="submission-header">
              <div class="submission-info">
                <h3>${escapeHtml(sub.name)}</h3>
                <div class="submission-meta">
                  <span><i data-lucide="mail"></i> ${escapeHtml(sub.email)}</span>
                  ${sub.project_type ? `<span><i data-lucide="folder"></i> ${escapeHtml(sub.project_type)}</span>` : ''}
                  <span><i data-lucide="clock"></i> ${formatDate(sub.submitted_at)}</span>
                </div>
              </div>
              <span class="submission-badge ${sub.read ? 'badge-read' : 'badge-unread'}">
                ${sub.read ? 'Read' : 'New'}
              </span>
            </div>
            <div class="submission-content">
              <p>${escapeHtml(sub.message).replace(/\n/g, '<br>')}</p>
            </div>
            ${!sub.read ? `
              <div class="submission-actions">
                <button class="btn-mark-read" onclick="markContactRead(${sub.id})">Mark as Read</button>
              </div>
            ` : ''}
          </div>
        `).join('');
        
        lucide.createIcons();
      } else {
        container.innerHTML = `<div class="error">Error loading submissions: ${data.error || 'Unknown error'}</div>`;
      }
    } catch (error) {
      container.innerHTML = `<div class="error">Failed to load submissions: ${error.message}</div>`;
    }
  }
  
  // Load quote submissions
  async function loadQuoteSubmissions() {
    const container = document.getElementById('quote-submissions');
    container.innerHTML = '<div class="loading">Loading quote submissions...</div>';
    
    try {
      const response = await fetch('/api/submissions/quote');
      const data = await response.json();
      
      if (data.success) {
        if (data.submissions.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <i data-lucide="inbox"></i>
              <p>No quote requests yet.</p>
            </div>
          `;
          lucide.createIcons();
          return;
        }
        
        container.innerHTML = data.submissions.map(sub => `
          <div class="submission-card ${sub.read ? '' : 'unread'}" data-id="${sub.id}">
            <div class="submission-header">
              <div class="submission-info">
                <h3>${escapeHtml(sub.name)}</h3>
                <div class="submission-meta">
                  <span><i data-lucide="mail"></i> ${escapeHtml(sub.email)}</span>
                  ${sub.package ? `<span><i data-lucide="package"></i> ${escapeHtml(sub.package)}</span>` : ''}
                  <span><i data-lucide="clock"></i> ${formatDate(sub.submitted_at)}</span>
                </div>
              </div>
              <span class="submission-badge ${sub.read ? 'badge-read' : 'badge-unread'}">
                ${sub.read ? 'Read' : 'New'}
              </span>
            </div>
            <div class="submission-content">
              <p>${escapeHtml(sub.project_details).replace(/\n/g, '<br>')}</p>
            </div>
            ${!sub.read ? `
              <div class="submission-actions">
                <button class="btn-mark-read" onclick="markQuoteRead(${sub.id})">Mark as Read</button>
              </div>
            ` : ''}
          </div>
        `).join('');
        
        lucide.createIcons();
      } else {
        container.innerHTML = `<div class="error">Error loading submissions: ${data.error || 'Unknown error'}</div>`;
      }
    } catch (error) {
      container.innerHTML = `<div class="error">Failed to load submissions: ${error.message}</div>`;
    }
  }
  
  // Mark contact as read
  async function markContactRead(id) {
    try {
      const response = await fetch(`/api/submissions/contact/${id}/read`, {
        method: 'PUT'
      });
      const data = await response.json();
      
      if (data.success) {
        loadContactSubmissions();
        loadStats();
      }
    } catch (error) {
      console.error('Error marking as read:', error);
      alert('Failed to mark as read');
    }
  }
  
  // Mark quote as read
  async function markQuoteRead(id) {
    try {
      const response = await fetch(`/api/submissions/quote/${id}/read`, {
        method: 'PUT'
      });
      const data = await response.json();
      
      if (data.success) {
        loadQuoteSubmissions();
        loadStats();
      }
    } catch (error) {
      console.error('Error marking as read:', error);
      alert('Failed to mark as read');
    }
  }
  
  // Utility functions
  function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }
  
  function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleString('en-US', {
      year: 'numeric',
      month: 'short',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });
  }
  
  // Initial load
  loadStats();
  loadContactSubmissions();
</script>

</body>
</html>








